<div class="grid-builder-container">
  <!-- Progress Header -->
  <header class="grid-builder-header">
    <div class="progress-section">
      <h1>{{ getStepTitle() }}</h1>
      <p>{{ getStepDescription() }}</p>

      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercentage()"></div>
      </div>

      <div class="step-indicators">
        @for (step of ['category', 'tiles', 'customization', 'preview',
        'publishing']; track step; let i = $index) {
        <button
          class="step-indicator"
          [class.active]="currentStepIndex() === i"
          [class.completed]="currentStepIndex() > i"
          (click)="goToStepString(step)"
          [attr.aria-label]="'Go to step ' + (i + 1)"
          type="button"
        >
          <span class="step-number">{{ i + 1 }}</span>
        </button>
        }
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="grid-builder-main">
    <!-- Category Selection Step -->
    @if (state().currentStep === 'category') {
    <div class="step-content category-step">
      <x86-category-selection
        [categories]="categories()"
        [selectedCategoryId]="state().selectedCategory"
        (categorySelected)="onCategorySelected($event)"
      ></x86-category-selection>
    </div>
    }

    <!-- tile Selection Step -->
    @if (state().currentStep === 'tiles') {
    <div class="step-content tiles-step">
      <x86-tile-selection
        [selectedTiles]="state().selectedTiles"
        [availableTiles]="availableTiles()"
        [aiSuggestions]="state().aiSuggestions"
        [categoryName]="state().selectedCategory"
        [searchQuery]="searchTiles()"
        (tileToggled)="toggleTileSelection($event)"
        (fillWithAI)="fillWithAISuggestions()"
        (clearAll)="clearAllTiles()"
        (searchChanged)="onSearchTiles($event)"
      ></x86-tile-selection>
    </div>
    }

    <!-- Customization Step -->
    @if (state().currentStep === 'customization') {
    <div class="step-content customization-step">
      <x86-grid-customization
        [customizationData]="gridCustomizationData"
        [selectedTheme]="state().selectedTheme"
        (titleChanged)="updateGridTitle($event)"
        (descriptionChanged)="updateGridDescription($event)"
        (publicToggled)="togglePublic()"
        (themeSelected)="onThemeSelected($event)"
      ></x86-grid-customization>
    </div>
    }

    <!-- Preview Step -->
    @if (state().currentStep === 'preview') {
    <div class="step-content preview-step">
      <x86-grid-preview
        [previewData]="gridPreviewData"
        (editRequested)="onPreviewEdit()"
        (generateRequested)="onPreviewGenerate()"
      ></x86-grid-preview>
    </div>
    }

    <!-- Publishing Step -->
    @if (state().currentStep === 'publishing') {
    <div class="step-content publishing-step">
      <x86-publishing
        [publishingData]="publishingData"
        (cancelRequested)="onPublishingCancel()"
        (playRequested)="onPublishingPlay($event)"
        (shareRequested)="onPublishingShare($event)"
        (viewRequested)="onPublishingView($event)"
        (createAnotherRequested)="onPublishingCreateAnother()"
        (retryRequested)="onPublishingRetry()"
        (goBackRequested)="onPublishingGoBack()"
      ></x86-publishing>
    </div>
    }
  </main>

  <!-- Navigation Footer -->
  <footer class="grid-builder-footer">
    <div class="nav-actions">
      @if (state().currentStep !== 'category' && state().currentStep !==
      'publishing') {
      <button class="btn btn-outline" (click)="previousStep()">
        ← Previous
      </button>
      } @if (state().currentStep !== 'preview' && state().currentStep !==
      'publishing') {
      <button
        class="btn btn-primary"
        (click)="nextStep()"
        [disabled]="!canProceedToNext()"
      >
        Next →
      </button>
      } @if (state().currentStep === 'preview') {
      <button
        class="btn btn-primary btn-large"
        (click)="generateGrid()"
        [disabled]="state().isGenerating"
      >
        🚀 Create Grid
      </button>
      }
    </div>
  </footer>
</div>
